import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';

export type Lang = 'en' | 'fr' | 'ar';

const TRANSLATIONS: Record<Lang, Record<string, string>> = {
  en: {
    // Sidebar
    'sidebar.permissions': 'Permissions',
    'sidebar.roles': 'Roles',
    'sidebar.users': 'Users',
    'sidebar.settings': 'Settings',
    'sidebar.dcf': 'DCF',
    // Header
    'header.title': 'DCF Production',
    'header.profile': 'Profile',
    'header.logout': 'Logout',
    // Footer
    'footer.text': 'dcf_production \u00A9 2026',
    // Login
    'login.title': 'DCF Production',
    'login.subtitle': 'Sign in to your account',
    'login.username': 'Username',
    'login.password': 'Password',
    'login.signin': 'Sign In',
    'login.enter_username': 'Enter username',
    'login.enter_password': 'Enter password',
    'login.validation': 'Please fill in all fields',
    // Profile
    'profile.title': 'Edit Profile',
    'profile.firstname': 'First Name',
    'profile.lastname': 'Last Name',
    'profile.password': 'New Password',
    'profile.password_hint': 'Leave empty to keep current',
    'profile.language': 'Language',
    'profile.save': 'Save',
    'profile.success': 'Profile updated',
    // Permissions
    'permissions.title': 'Permissions',
    'permissions.add': 'Add Permission',
    'permissions.edit': 'Edit Permission',
    'permissions.id': 'ID',
    'permissions.name': 'Name',
    'permissions.actions': 'Actions',
    'permissions.no_data': 'No permissions found',
    'permissions.saved': 'Permission saved',
    'permissions.deleted': 'Permission deleted',
    'permissions.confirm_delete': 'Delete permission',
    'permissions.search': 'Search permissions...',
    // Roles
    'roles.title': 'Roles',
    'roles.add': 'Add Role',
    'roles.edit': 'Edit Role',
    'roles.name': 'Name',
    'roles.permissions': 'Permissions',
    'roles.actions': 'Actions',
    'roles.protected': 'Protected',
    'roles.saved': 'Role saved',
    'roles.deleted': 'Role deleted',
    'roles.confirm_delete': 'Delete role',
    'roles.no_data': 'No roles found',
    'roles.search': 'Search roles...',
    // Users
    'users.title': 'Users',
    'users.add': 'Add User',
    'users.edit': 'Edit User',
    'users.username': 'Username',
    'users.password': 'Password',
    'users.password_edit': 'Password (leave empty to keep)',
    'users.firstname': 'First Name',
    'users.lastname': 'Last Name',
    'users.role': 'Role',
    'users.language': 'Language',
    'users.actions': 'Actions',
    'users.protected': 'Protected',
    'users.saved': 'User saved',
    'users.deleted': 'User deleted',
    'users.confirm_delete': 'Delete user',
    'users.no_data': 'No users found',
    'users.search': 'Search users...',
    // Settings
    'settings.title': 'Settings',
    'settings.api_key': 'OpenAI API Key',
    'settings.agent1': 'Agent 1 - Company Existence Validation',
    'settings.agent2': 'Agent 2 - DCF Input Data Collection',
    'settings.agent3': 'Agent 3 - DCF Calculation',
    'settings.agent4': 'Agent 4 - Validation & Realism Audit',
    'settings.save': 'Save Settings',
    'settings.saved': 'Settings saved successfully',
    'settings.enter_key': 'Enter OpenAI API Key',
    // DCF
    'dcf.title': 'DCF Analysis',
    'dcf.company_name': 'Company Name',
    'dcf.company_placeholder': 'e.g. CACC - Credit Acceptance Corporation',
    'dcf.go': 'GO',
    'dcf.running': 'Running DCF Analysis...',
    'dcf.stop': 'Stop',
    'dcf.stopped': 'Analysis stopped',
    'dcf.stopped_detail': 'The DCF agents have been cancelled.',
    'dcf.agent_working': 'Agent {0} is working: {1}',
    'dcf.agent_complete': 'Agent {0} completed: {1}',
    'dcf.complete': 'DCF Analysis Complete!',
    'dcf.download': 'Download Valuation Report (ZIP)',
    'dcf.error': 'Error',
    'dcf.idle': 'Enter a company name and click GO to start the DCF analysis.',
    'dcf.generating_report': 'Generating PDF & Excel reports...',
    // Sidebar
    'sidebar.kpi': 'KPI Dashboard',
    // KPI
    'kpi.title': 'KPI Dashboard',
    'kpi.total': 'Total Analyses',
    'kpi.validated': 'Validated',
    'kpi.unique_companies': 'Unique Companies',
    'kpi.status_breakdown': 'Status Breakdown',
    'kpi.monthly': 'Monthly Analyses',
    'kpi.top_companies': 'Top Companies',
    'kpi.analyses': 'Analyses',
    'kpi.col_id': 'ID',
    'kpi.col_date': 'Date',
    'kpi.col_user': 'User',
    'kpi.col_company': 'Company',
    'kpi.col_status': 'Status',
    'kpi.col_description': 'Description',
    'kpi.no_data': 'No analyses recorded yet',
    'kpi.view_more': 'View full description',
    // Common
    'common.save': 'Save',
    'common.cancel': 'Cancel',
    'common.delete': 'Delete',
    'common.confirm': 'Confirm',
    'common.success': 'Success',
    'common.error': 'Error',
    'common.id': 'ID',
    'common.actions': 'Actions',
    'common.confirm_delete': 'Confirm Delete',
    'common.select': 'Select',
  },
  fr: {
    'sidebar.permissions': 'Permissions',
    'sidebar.roles': 'R\u00F4les',
    'sidebar.users': 'Utilisateurs',
    'sidebar.settings': 'Param\u00E8tres',
    'sidebar.dcf': 'DCF',
    'header.title': 'DCF Production',
    'header.profile': 'Profil',
    'header.logout': 'D\u00E9connexion',
    'footer.text': 'dcf_production \u00A9 2026',
    'login.title': 'DCF Production',
    'login.subtitle': 'Connectez-vous \u00E0 votre compte',
    'login.username': "Nom d'utilisateur",
    'login.password': 'Mot de passe',
    'login.signin': 'Se connecter',
    'login.enter_username': "Entrez le nom d'utilisateur",
    'login.enter_password': 'Entrez le mot de passe',
    'login.validation': 'Veuillez remplir tous les champs',
    'profile.title': 'Modifier le profil',
    'profile.firstname': 'Pr\u00E9nom',
    'profile.lastname': 'Nom',
    'profile.password': 'Nouveau mot de passe',
    'profile.password_hint': 'Laisser vide pour garder le mot de passe actuel',
    'profile.language': 'Langue',
    'profile.save': 'Enregistrer',
    'profile.success': 'Profil mis \u00E0 jour',
    'permissions.title': 'Permissions',
    'permissions.add': 'Ajouter permission',
    'permissions.edit': 'Modifier permission',
    'permissions.id': 'ID',
    'permissions.name': 'Nom',
    'permissions.actions': 'Actions',
    'permissions.no_data': 'Aucune permission trouv\u00E9e',
    'permissions.saved': 'Permission enregistr\u00E9e',
    'permissions.deleted': 'Permission supprim\u00E9e',
    'permissions.confirm_delete': 'Supprimer la permission',
    'permissions.search': 'Rechercher des permissions...',
    'roles.title': 'R\u00F4les',
    'roles.add': 'Ajouter r\u00F4le',
    'roles.edit': 'Modifier r\u00F4le',
    'roles.name': 'Nom',
    'roles.permissions': 'Permissions',
    'roles.actions': 'Actions',
    'roles.protected': 'Prot\u00E9g\u00E9',
    'roles.saved': 'R\u00F4le enregistr\u00E9',
    'roles.deleted': 'R\u00F4le supprim\u00E9',
    'roles.confirm_delete': 'Supprimer le r\u00F4le',
    'roles.no_data': 'Aucun r\u00F4le trouv\u00E9',
    'roles.search': 'Rechercher des r\u00F4les...',
    'users.title': 'Utilisateurs',
    'users.add': 'Ajouter utilisateur',
    'users.edit': 'Modifier utilisateur',
    'users.username': "Nom d'utilisateur",
    'users.password': 'Mot de passe',
    'users.password_edit': 'Mot de passe (laisser vide pour garder)',
    'users.firstname': 'Pr\u00E9nom',
    'users.lastname': 'Nom',
    'users.role': 'R\u00F4le',
    'users.language': 'Langue',
    'users.actions': 'Actions',
    'users.protected': 'Prot\u00E9g\u00E9',
    'users.saved': 'Utilisateur enregistr\u00E9',
    'users.deleted': 'Utilisateur supprim\u00E9',
    'users.confirm_delete': "Supprimer l'utilisateur",
    'users.no_data': 'Aucun utilisateur trouv\u00E9',
    'users.search': 'Rechercher des utilisateurs...',
    'settings.title': 'Param\u00E8tres',
    'settings.api_key': 'OpenAI  Cl\u00E9 API',
    'settings.agent1': 'Agent 1 - Validation existence entreprise',
    'settings.agent2': 'Agent 2 - Collecte donn\u00E9es DCF',
    'settings.agent3': 'Agent 3 - Calcul DCF',
    'settings.agent4': 'Agent 4 - Audit & Validation',
    'settings.save': 'Enregistrer les param\u00E8tres',
    'settings.saved': 'Param\u00E8tres enregistr\u00E9s',
    'settings.enter_key': 'Entrer la cl\u00E9 API OpenAI',
    'dcf.title': 'Analyse DCF',
    'dcf.company_name': "Nom de l'entreprise",
    'dcf.company_placeholder': 'ex: CACC - Credit Acceptance Corporation',
    'dcf.go': 'LANCER',
    'dcf.running': "Analyse DCF en cours...",
    'dcf.stop': 'Arrêter',
    'dcf.stopped': 'Analyse arrêtée',
    'dcf.stopped_detail': "Les agents DCF ont été annulés.",
    'dcf.agent_working': "L'agent {0} travaille: {1}",
    'dcf.agent_complete': "L'agent {0} termin\u00E9: {1}",
    'dcf.complete': 'Analyse DCF termin\u00E9e !',
    'dcf.download': 'T\u00E9l\u00E9charger le rapport (ZIP)',
    'dcf.error': 'Erreur',
    'dcf.idle': "Entrez un nom d'entreprise et cliquez LANCER pour d\u00E9marrer l'analyse DCF.",
    'dcf.generating_report': 'G\u00E9n\u00E9ration des rapports PDF & Excel...',
    'sidebar.kpi': 'Tableau de bord KPI',
    'kpi.title': 'Tableau de bord KPI',
    'kpi.total': 'Total des analyses',
    'kpi.validated': 'Valid\u00E9es',
    'kpi.unique_companies': 'Entreprises uniques',
    'kpi.status_breakdown': 'R\u00E9partition par statut',
    'kpi.monthly': 'Analyses mensuelles',
    'kpi.top_companies': 'Top entreprises',
    'kpi.analyses': 'Analyses',
    'kpi.col_id': 'ID',
    'kpi.col_date': 'Date',
    'kpi.col_user': 'Utilisateur',
    'kpi.col_company': 'Entreprise',
    'kpi.col_status': 'Statut',
    'kpi.col_description': 'Description',
    'kpi.no_data': 'Aucune analyse enregistr\u00E9e',
    'kpi.view_more': 'Voir la description compl\u00E8te',
    'common.save': 'Enregistrer',
    'common.cancel': 'Annuler',
    'common.delete': 'Supprimer',
    'common.confirm': 'Confirmer',
    'common.success': 'Succ\u00E8s',
    'common.error': 'Erreur',
    'common.id': 'ID',
    'common.actions': 'Actions',
    'common.confirm_delete': 'Confirmer la suppression',
    'common.select': 'S\u00E9lectionner',
  },
  ar: {
    'sidebar.permissions': '\u0627\u0644\u0635\u0644\u0627\u062D\u064A\u0627\u062A',
    'sidebar.roles': '\u0627\u0644\u0623\u062F\u0648\u0627\u0631',
    'sidebar.users': '\u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645\u0648\u0646',
    'sidebar.settings': '\u0627\u0644\u0625\u0639\u062F\u0627\u062F\u0627\u062A',
    'sidebar.dcf': 'DCF',
    'header.title': 'DCF Production',
    'header.profile': '\u0627\u0644\u0645\u0644\u0641 \u0627\u0644\u0634\u062E\u0635\u064A',
    'header.logout': '\u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062E\u0631\u0648\u062C',
    'footer.text': 'dcf_production \u00A9 2026',
    'login.title': 'DCF Production',
    'login.subtitle': '\u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644 \u0625\u0644\u0649 \u062D\u0633\u0627\u0628\u0643',
    'login.username': '\u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645',
    'login.password': '\u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631',
    'login.signin': '\u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644',
    'login.enter_username': '\u0623\u062F\u062E\u0644 \u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645',
    'login.enter_password': '\u0623\u062F\u062E\u0644 \u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631',
    'login.validation': '\u064A\u0631\u062C\u0649 \u0645\u0644\u0621 \u062C\u0645\u064A\u0639 \u0627\u0644\u062D\u0642\u0648\u0644',
    'profile.title': '\u062A\u0639\u062F\u064A\u0644 \u0627\u0644\u0645\u0644\u0641 \u0627\u0644\u0634\u062E\u0635\u064A',
    'profile.firstname': '\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0623\u0648\u0644',
    'profile.lastname': '\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0623\u062E\u064A\u0631',
    'profile.password': '\u0643\u0644\u0645\u0629 \u0645\u0631\u0648\u0631 \u062C\u062F\u064A\u062F\u0629',
    'profile.password_hint': '\u0627\u062A\u0631\u0643\u0647 \u0641\u0627\u0631\u063A\u0627\u064B \u0644\u0644\u0627\u062D\u062A\u0641\u0627\u0638 \u0628\u0627\u0644\u062D\u0627\u0644\u064A',
    'profile.language': '\u0627\u0644\u0644\u063A\u0629',
    'profile.save': '\u062D\u0641\u0638',
    'profile.success': '\u062A\u0645 \u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0645\u0644\u0641 \u0627\u0644\u0634\u062E\u0635\u064A',
    'permissions.title': '\u0627\u0644\u0635\u0644\u0627\u062D\u064A\u0627\u062A',
    'permissions.add': '\u0625\u0636\u0627\u0641\u0629 \u0635\u0644\u0627\u062D\u064A\u0629',
    'permissions.edit': '\u062A\u0639\u062F\u064A\u0644 \u0635\u0644\u0627\u062D\u064A\u0629',
    'permissions.id': '\u0627\u0644\u0645\u0639\u0631\u0641',
    'permissions.name': '\u0627\u0644\u0627\u0633\u0645',
    'permissions.actions': '\u0627\u0644\u0625\u062C\u0631\u0627\u0621\u0627\u062A',
    'permissions.no_data': '\u0644\u0627 \u062A\u0648\u062C\u062F \u0635\u0644\u0627\u062D\u064A\u0627\u062A',
    'permissions.saved': '\u062A\u0645 \u062D\u0641\u0638 \u0627\u0644\u0635\u0644\u0627\u062D\u064A\u0629',
    'permissions.deleted': '\u062A\u0645 \u062D\u0630\u0641 \u0627\u0644\u0635\u0644\u0627\u062D\u064A\u0629',
    'permissions.confirm_delete': '\u062D\u0630\u0641 \u0627\u0644\u0635\u0644\u0627\u062D\u064A\u0629',
    'permissions.search': '\u0628\u062D\u062B \u0641\u064A \u0627\u0644\u0635\u0644\u0627\u062D\u064A\u0627\u062A...',
    'roles.title': '\u0627\u0644\u0623\u062F\u0648\u0627\u0631',
    'roles.add': '\u0625\u0636\u0627\u0641\u0629 \u062F\u0648\u0631',
    'roles.edit': '\u062A\u0639\u062F\u064A\u0644 \u062F\u0648\u0631',
    'roles.name': '\u0627\u0644\u0627\u0633\u0645',
    'roles.permissions': '\u0627\u0644\u0635\u0644\u0627\u062D\u064A\u0627\u062A',
    'roles.actions': '\u0627\u0644\u0625\u062C\u0631\u0627\u0621\u0627\u062A',
    'roles.protected': '\u0645\u062D\u0645\u064A',
    'roles.saved': '\u062A\u0645 \u062D\u0641\u0638 \u0627\u0644\u062F\u0648\u0631',
    'roles.deleted': '\u062A\u0645 \u062D\u0630\u0641 \u0627\u0644\u062F\u0648\u0631',
    'roles.confirm_delete': '\u062D\u0630\u0641 \u0627\u0644\u062F\u0648\u0631',
    'roles.no_data': '\u0644\u0627 \u062A\u0648\u062C\u062F \u0623\u062F\u0648\u0627\u0631',
    'roles.search': '\u0628\u062D\u062B \u0641\u064A \u0627\u0644\u0623\u062F\u0648\u0627\u0631...',
    'users.title': '\u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645\u0648\u0646',
    'users.add': '\u0625\u0636\u0627\u0641\u0629 \u0645\u0633\u062A\u062E\u062F\u0645',
    'users.edit': '\u062A\u0639\u062F\u064A\u0644 \u0645\u0633\u062A\u062E\u062F\u0645',
    'users.username': '\u0627\u0633\u0645 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645',
    'users.password': '\u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631',
    'users.password_edit': '\u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631 (\u0627\u062A\u0631\u0643\u0647 \u0641\u0627\u0631\u063A\u0627\u064B \u0644\u0644\u0627\u062D\u062A\u0641\u0627\u0638)',
    'users.firstname': '\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0623\u0648\u0644',
    'users.lastname': '\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0623\u062E\u064A\u0631',
    'users.role': '\u0627\u0644\u062F\u0648\u0631',
    'users.language': '\u0627\u0644\u0644\u063A\u0629',
    'users.actions': '\u0627\u0644\u0625\u062C\u0631\u0627\u0621\u0627\u062A',
    'users.protected': '\u0645\u062D\u0645\u064A',
    'users.saved': '\u062A\u0645 \u062D\u0641\u0638 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645',
    'users.deleted': '\u062A\u0645 \u062D\u0630\u0641 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645',
    'users.confirm_delete': '\u062D\u0630\u0641 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645',
    'users.no_data': '\u0644\u0627 \u062A\u0648\u062C\u062F \u0645\u0633\u062A\u062E\u062F\u0645\u0648\u0646',
    'users.search': '\u0628\u062D\u062B \u0639\u0646 \u0645\u0633\u062A\u062E\u062F\u0645\u064A\u0646...',
    'settings.title': '\u0627\u0644\u0625\u0639\u062F\u0627\u062F\u0627\u062A',
    'settings.api_key': '\u0645\u0641\u062A\u0627\u062D API',
    'settings.agent1': '\u0627\u0644\u0648\u0643\u064A\u0644 1 - \u0627\u0644\u062A\u062D\u0642\u0642 \u0645\u0646 \u0648\u062C\u0648\u062F \u0627\u0644\u0634\u0631\u0643\u0629',
    'settings.agent2': '\u0627\u0644\u0648\u0643\u064A\u0644 2 - \u062C\u0645\u0639 \u0628\u064A\u0627\u0646\u0627\u062A DCF',
    'settings.agent3': '\u0627\u0644\u0648\u0643\u064A\u0644 3 - \u062D\u0633\u0627\u0628 DCF',
    'settings.agent4': '\u0627\u0644\u0648\u0643\u064A\u0644 4 - \u0627\u0644\u062A\u062F\u0642\u064A\u0642 \u0648\u0627\u0644\u062A\u062D\u0642\u0642',
    'settings.save': '\u062D\u0641\u0638 \u0627\u0644\u0625\u0639\u062F\u0627\u062F\u0627\u062A',
    'settings.saved': '\u062A\u0645 \u062D\u0641\u0638 \u0627\u0644\u0625\u0639\u062F\u0627\u062F\u0627\u062A',
    'settings.enter_key': '\u0623\u062F\u062E\u0644 \u0645\u0641\u062A\u0627\u062D OpenAI API',
    'dcf.title': '\u062A\u062D\u0644\u064A\u0644 DCF',
    'dcf.company_name': '\u0627\u0633\u0645 \u0627\u0644\u0634\u0631\u0643\u0629',
    'dcf.company_placeholder': '\u0645\u062B\u0627\u0644: CACC - Credit Acceptance Corporation',
    'dcf.go': '\u0627\u0628\u062F\u0623',
    'dcf.running': '\u062C\u0627\u0631\u064A \u062A\u062D\u0644\u064A\u0644 DCF...',
    'dcf.stop': '\u0625\u064A\u0642\u0627\u0641',
    'dcf.stopped': '\u062A\u0645 \u0625\u064A\u0642\u0627\u0641 \u0627\u0644\u062A\u062D\u0644\u064A\u0644',
    'dcf.stopped_detail': '\u062A\u0645 \u0625\u0644\u063A\u0627\u0621 \u0639\u0645\u0644 \u0648\u0643\u0644\u0627\u0621 DCF.',
    'dcf.agent_working': '\u0627\u0644\u0648\u0643\u064A\u0644 {0} \u064A\u0639\u0645\u0644: {1}',
    'dcf.agent_complete': '\u0627\u0644\u0648\u0643\u064A\u0644 {0} \u0627\u0643\u062A\u0645\u0644: {1}',
    'dcf.complete': '\u0627\u0643\u062A\u0645\u0644 \u062A\u062D\u0644\u064A\u0644 DCF!',
    'dcf.download': '\u062A\u062D\u0645\u064A\u0644 \u062A\u0642\u0631\u064A\u0631 \u0627\u0644\u062A\u0642\u064A\u064A\u0645 (ZIP)',
    'dcf.error': '\u062E\u0637\u0623',
    'dcf.idle': '\u0623\u062F\u062E\u0644 \u0627\u0633\u0645 \u0627\u0644\u0634\u0631\u0643\u0629 \u0648\u0627\u0646\u0642\u0631 \u0627\u0628\u062F\u0623 \u0644\u0628\u062F\u0621 \u062A\u062D\u0644\u064A\u0644 DCF.',
    'dcf.generating_report': '\u062C\u0627\u0631\u064A \u0625\u0646\u0634\u0627\u0621 \u062A\u0642\u0627\u0631\u064A\u0631 PDF \u0648 Excel...',
    'sidebar.kpi': '\u0644\u0648\u062D\u0629 \u0627\u0644\u0645\u0624\u0634\u0631\u0627\u062A',
    'kpi.title': '\u0644\u0648\u062D\u0629 \u0627\u0644\u0645\u0624\u0634\u0631\u0627\u062A',
    'kpi.total': '\u0625\u062C\u0645\u0627\u0644\u064A \u0627\u0644\u062A\u062D\u0644\u064A\u0644\u0627\u062A',
    'kpi.validated': '\u0645\u0639\u062A\u0645\u062F\u0629',
    'kpi.unique_companies': '\u0634\u0631\u0643\u0627\u062A \u0641\u0631\u064A\u062F\u0629',
    'kpi.status_breakdown': '\u062A\u0648\u0632\u064A\u0639 \u0627\u0644\u062D\u0627\u0644\u0629',
    'kpi.monthly': '\u0627\u0644\u062A\u062D\u0644\u064A\u0644\u0627\u062A \u0627\u0644\u0634\u0647\u0631\u064A\u0629',
    'kpi.top_companies': '\u0623\u0628\u0631\u0632 \u0627\u0644\u0634\u0631\u0643\u0627\u062A',
    'kpi.analyses': '\u062A\u062D\u0644\u064A\u0644\u0627\u062A',
    'kpi.col_id': '\u0627\u0644\u0645\u0639\u0631\u0641',
    'kpi.col_date': '\u0627\u0644\u062A\u0627\u0631\u064A\u062E',
    'kpi.col_user': '\u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645',
    'kpi.col_company': '\u0627\u0644\u0634\u0631\u0643\u0629',
    'kpi.col_status': '\u0627\u0644\u062D\u0627\u0644\u0629',
    'kpi.col_description': '\u0627\u0644\u0648\u0635\u0641',
    'kpi.no_data': '\u0644\u0627 \u062A\u0648\u062C\u062F \u062A\u062D\u0644\u064A\u0644\u0627\u062A \u0645\u0633\u062C\u0644\u0629',
    'kpi.view_more': '\u0639\u0631\u0636 \u0627\u0644\u0648\u0635\u0641 \u0627\u0644\u0643\u0627\u0645\u0644',
    'common.save': '\u062D\u0641\u0638',
    'common.cancel': '\u0625\u0644\u063A\u0627\u0621',
    'common.delete': '\u062D\u0630\u0641',
    'common.confirm': '\u062A\u0623\u0643\u064A\u062F',
    'common.success': '\u0646\u062C\u0627\u062D',
    'common.error': '\u062E\u0637\u0623',
    'common.id': '\u0627\u0644\u0645\u0639\u0631\u0641',
    'common.actions': '\u0627\u0644\u0625\u062C\u0631\u0627\u0621\u0627\u062A',
    'common.confirm_delete': '\u062A\u0623\u0643\u064A\u062F \u0627\u0644\u062D\u0630\u0641',
    'common.select': '\u0627\u062E\u062A\u064A\u0627\u0631',
  }
};

@Injectable({ providedIn: 'root' })
export class TranslateService {
  private currentLang: Lang = 'en';
  private langSubject = new BehaviorSubject<Lang>('en');
  lang$ = this.langSubject.asObservable();

  constructor() {
    const stored = localStorage.getItem('app_language') as Lang;
    if (stored && ['en', 'fr', 'ar'].includes(stored)) {
      this.setLanguage(stored);
    }
  }

  get lang(): Lang { return this.currentLang; }

  setLanguage(lang: Lang): void {
    this.currentLang = lang;
    localStorage.setItem('app_language', lang);
    this.langSubject.next(lang);
    // Set document direction for RTL
    if (typeof document !== 'undefined') {
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
      document.documentElement.lang = lang;
    }
  }

  t(key: string, ...args: any[]): string {
    let value = TRANSLATIONS[this.currentLang]?.[key] || TRANSLATIONS['en']?.[key] || key;
    // Replace {0}, {1}, etc. with args
    args.forEach((arg, i) => {
      value = value.replace(`{${i}}`, String(arg));
    });
    return value;
  }
}
